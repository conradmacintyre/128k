const minefield=document.getElementById("minefield");let bombPercentage=10,totalBombs=0;const tileSize=35;let minefieldColumns=0,minefieldRows=0,totalTiles=0,bombArray=[];function minefieldStats(){let e=minefield.getBoundingClientRect();minefieldColumns=parseInt(e.width/35),minefieldRows=parseInt(e.height/35),totalTiles=minefieldColumns*minefieldRows,totalBombs=parseInt(totalTiles/bombPercentage)}function makeMine(e,t,o){let l=document.createElement("span");l.className=`tile col-${t} row-${o}`,l.id=`tile-${e}`,l.setAttribute("data-col",t),l.setAttribute("data-row",o),minefield.append(l)}function setBombs(){totalBombs=parseInt(totalTiles/100*bombPercentage);let e=1;for(;e<=totalBombs;){let t=Math.floor(Math.random()*totalTiles);-1==bombArray.indexOf(t)&&(bombArray.push(t),e++)}bombArray.forEach((e=>{document.getElementById("tile-"+e).classList.add("bomb")}))}function setTouches(){[...document.getElementsByClassName("tile")].forEach((e=>{let t=parseInt(e.getAttribute("data-row")),o=parseInt(e.getAttribute("data-col")),l=0,s=o-1,n=o+1,i=t-1,a=t+1;[".col-"+s+".row-"+i,".col-"+o+".row-"+i,".col-"+n+".row-"+i,".col-"+s+".row-"+t,".col-"+n+".row-"+t,".col-"+s+".row-"+a,".col-"+o+".row-"+a,".col-"+n+".row-"+a].forEach((e=>{let t=document.querySelectorAll(e);t.length>0&&t[0].classList.contains("bomb")&&l++})),!e.classList.contains("bomb")&&l>0?(e.classList.add("touch"),e.setAttribute("data-touches",l),e.innerText=l):e.classList.contains("bomb")||0!=l||e.classList.add("empty")}))}function bombBlown(e){console.log("Bomb Blown"),e.classList.add("show")}function addFlag(e){console.log(e,"flagged"),e.classList.toggle("flagged")}function sprawl(e){console.log("nothing here");let t=e,o=[t];for(console.log("A",o);o.length>0;){o[0];o.splice(0,1),console.log("B",o);let e=parseInt(t.getAttribute("data-row")),l=parseInt(t.getAttribute("data-col")),s=l-1,n=l+1,i=e-1,a=e+1;[".col-"+s+".row-"+i,".col-"+l+".row-"+i,".col-"+n+".row-"+i,".col-"+s+".row-"+e,".col-"+n+".row-"+e,".col-"+s+".row-"+a,".col-"+l+".row-"+a,".col-"+n+".row-"+a].forEach((e=>{let t=document.querySelectorAll(e);t.length>0&&(t[0].classList.contains("empty")&&!t[0].classList.contains("show")||t[0].classList.contains("touch")&&!t[0].classList.contains("show"))&&(console.log("C",o),o.push(t[0]),console.log("D",o),t[0].classList.add("show"))}))}}function revealTile(e,t){e.classList.contains("bomb")?bombBlown(e):(e.classList.contains("touch")||e.classList.contains("empty"))&&sprawl(e)}function findClickDuration(e){let t=e,o=-1;e.addEventListener("mousedown",(()=>{o=setTimeout((function(){addFlag(t)}),800)})),e.addEventListener("mouseup",(()=>{o>=0&&o<800&&revealTile(t,o),clearTimeout(o),o=-1})),e.addEventListener("mouseleave",(e=>{o>=0&&o<800&&revealTile(t,o),clearTimeout(o),o=-1}))}function interactiveTile(){[...document.getElementsByClassName("tile")].forEach((e=>findClickDuration(e)))}function fieldBuilder(){minefieldStats();let e=1,t=0,o=0;for(;e<=totalTiles;)t<minefieldColumns?t++:t=1,1==t&&o++,makeMine(e,t,o),e++;setBombs(),setTouches(),interactiveTile()}window.addEventListener("load",(()=>fieldBuilder()));